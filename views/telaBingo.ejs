<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <title>Sala do dede</title>
</head>
<body>
    <%- include('modulos/cabecalho', {salaAnterior: 'Teste'}) %> 

     <!-- e aquela parte roxa da tela -->
    <%- include('modulos/conteudo', {parte: 'abrir'}) %> 
    <div class="tela-bingo">
        <div class="tela-bingo__bolas-bingo bolas-bingo">
            <div class="bolas-bingo__principal ">
                <span class="bolas-bingo__principal-valor">12</span>
            </div>

            <div class="bolas-bingo__secundarias">
                <div class="bolas-secundarias bolas-secundarias__esquerda">
                    <span class='bolas-secundarias__esquerda-valor'>0</span>
                </div>
                
                <div class="bolas-secundarias bolas-secundarias__meio">
                    <span class='bolas-secundarias__meio-valor'>69</span>
                </div>
                
                <div class="bolas-secundarias bolas-secundarias__direita">
                    <span class='bolas-secundarias__direita-valor'>99</span>
                </div>
            </div>
        </div>

        <div class="tela-bingo__tabela-bingo tabela-bingo">
            <div class="tabela-bingo__item tabela-bingo__item--letra">B</div>
            <div class="tabela-bingo__item tabela-bingo__item--letra">I</div>
            <div class="tabela-bingo__item tabela-bingo__item--letra">N</div>
            <div class="tabela-bingo__item tabela-bingo__item--letra">G</div>
            <div class="tabela-bingo__item tabela-bingo__item--letra">O</div>
            
            <% for( let i = 0; i < 25; i++ ) { %>
                <div class="tabela-bingo__item" onclick="mudancaItemCartela(this)">
                    <span><%= i _%></span>
                </div>
            <% } %>
        </div>

        <button class="botao-bingo">Bingo!!!</button>

    </div>  
    <%- include('modulos/conteudo', {parte: 'fechar'}) %>
    <script>
        const bolaPrincipal = document.querySelector('.bolas-bingo__principal-valor')
        const bolaEsquerda = document.querySelector('.bolas-secundarias__esquerda-valor')
        const bolaMeio = document.querySelector('.bolas-secundarias__meio-valor')
        const bolaDireita = document.querySelector('.bolas-secundarias__direita-valor')

        const listaBolas = [bolaPrincipal, bolaEsquerda, bolaMeio, bolaDireita]

        function mudancaItemCartela(elemento){
            if (!(elemento instanceof Element)){
                return
            }

            elemento.classList.toggle('tabela-bingo__item--selecionado')
        }

        function atualizarPedras(novaPedra){
            if (typeof novaPedra !== 'number'){
                return
            }

            const bolasNovoValor = [novaPedra,  bolaPrincipal.innerHTML, bolaEsquerda.innerHTML, bolaMeio.innerHTML]
            const temposTimeOut = [0, .2, .4, .6]   

            listaBolas.forEach((bola, index) => {
                setTimeout(() => {
                    bola.classList.remove('bolas-giratorias--desativado')
                    bola.classList.add('bolas-giratorias--ativado')
                    // precisa ser 'ontransitionend' aqui, para ele poder ser desatribuido depois
                    bola.ontransitionend = () => mudarNumero(bola, bolasNovoValor[index])
                }, temposTimeOut[index] * 1000)
            })

            function mudarNumero(elemento, novoValor){
                if (!(elemento instanceof Element)){
                    return
                }

                elemento.innerHTML = novoValor
                elemento.classList.add('bolas-giratorias--desativado')
                elemento.classList.remove('bolas-giratorias--ativado')
                //aqui ele eh desatribuido
                elemento.ontransitionend = null
            }
            
        }
    </script>
</body>
</html>